<?

set_time_limit(9999999);

include_once($_SERVER["DOCUMENT_ROOT"]."/admin/openapi/openapi.lib.php");
include_once($_SERVER["DOCUMENT_ROOT"]."/admin/sellertool/sellertool.lib.php");
include_once($_SERVER["DOCUMENT_ROOT"]."/include/global_util.php");
include_once($_SERVER["DOCUMENT_ROOT"]."/include/lib.function.php");
include_once($_SERVER["DOCUMENT_ROOT"]."/admin/include/admin.util.php");

//30분마다!

$db = new Database();

$sql = "select mall_ix,mall_data_root, mall_type from shop_shopinfo  where mall_div = 'B'  ";
$db->query($sql);
$db->fetch();

$admininfo[mall_ix] = $db->dt[mall_ix];
$admininfo[mall_data_root] = $db->dt[mall_data_root];
$admininfo[admin_level] = 9;
$admininfo[language] = 'korea';
$admininfo[mall_type] = $db->dt[mall_type];
$admin_config[mall_data_root] = $db->dt[mall_data_root];

$array_pid = array();


$fp = fopen($_SERVER["DOCUMENT_ROOT"].'/data/daiso_data/_logs/sellertool_putgoods.log', 'a');
$fh = '----------SELLER START [' . date('Y-m-d H:i:s') . '] ----------' . chr(13);
fwrite($fp, $fh);


if($check){
	$sql="select count(*) as total from sellertool_log where result_code='200'";
	$db->query($sql);
	$db->fetch();
	echo $db->dt[total];
	exit;
}

//모든상품 올리기!
$sql="select p.id from shop_product p left join common_company_detail ccd on (p.admin=ccd.company_id) where p.state in ('1','0') and p.disp='1' and p.admin in ('362ed8ee1cba4cc34f80aa5529d2fbcd','c72e0d088cbfdd30452ca85472739747') order by p.id";

/*
$sql="select p.id from shop_product p where p.id in ('0000078857','0000078859','0000079003','0000079060','0000079101','0000084381','0000281163','0000281165','0000087344','0000087348','0000087350','0000087352','0000087354','0000087356','0000087358','0000087360','0000087361','0000087365','0000087367','0000087671','0000088101','0000088121','0000088168','0000088174','0000088242','0000088277','0000088296','0000088333','0000088339','0000088376','0000088382','0000088383','0000088393','0000088430','0000088431','0000088432','0000088442','0000088443','0000088444','0000088451','0000088453','0000088454','0000088456','0000088463','0000088466','0000088476','0000088628','0000088641','0000088642','0000254616','0000281168','0000075979','0000077552','0000078807','0000079660','0000081863','0000081884','0000081992','0000082305','0000083243','0000083245','0000083247','0000083872','0000083874','0000084533','0000085898','0000086425','0000086958','0000086962','0000087000','0000087218','0000075923','0000084735','0000084736','0000084737','0000084738','0000084739','0000084740','0000084741','0000084742','0000084743','0000084744','0000084745','0000084750','0000084751','0000084753','0000084755','0000084759','0000084760','0000084763','0000084765','0000084770','0000084772','0000084773','0000084774','0000084775','0000084777','0000084779','0000084795','0000084796','0000084801','0000084803','0000084804','0000084806','0000084808','0000084812','0000084815','0000084817','0000084820','0000084823','0000084824','0000084825','0000084826','0000084827','0000084828','0000084829','0000084830','0000084831','0000084875','0000084876','0000084877','0000084878','0000084879','0000084880','0000084881','0000084892','0000084903','0000084938','0000084939','0000084940','0000084941','0000084943','0000084944','0000084945','0000084946','0000084947','0000084948','0000084949','0000084950','0000084951','0000084954','0000084958','0000086913','0000086915','0000086917','0000086961','0000086963','0000086991','0000087040','0000087042','0000087044','0000087046','0000087052','0000087060','0000087062','0000087064','0000087066','0000087068','0000087074','0000087076','0000087082','0000087084','0000087099','0000087102','0000087104','0000087108','0000087110','0000087112','0000087114','0000087116','0000087118','0000087120','0000087122','0000087124','0000087126','0000087138') order by p.id";

$sql="select p.id from shop_product p left join common_company_detail ccd on (p.admin=ccd.company_id) where ccd.halfclub_code!='' and p.state in ('1','0') and p.disp='1' and p.admin in ('e7c46445c93e11186c86202e19f510bd','8a23d817c5e0c55a4f630411be1b0e1d','ec9c3e260fac6c1b5fd7088428bb09d4','82177f18837f7f4919cbc08e1f3b7981','2150d99e258be5880876e46169c39360','5ca4a9db00e88e9fb7306eac4f5634d3','473922dddee8a727d953fde1eced5cc4','e3f3b3d9dee86959a05f5bb85a4eb5e0','5a2cd63576d88132605ffc198e035617','a81e07ccaccfee5a53e6edb567b23416','b5a4d66bccf3169df28237ff78579683','79e3f05190a6d6858678d06658c38969','b771719a22f483087cc3af0d8e296c1c','0cbb4f09f1110f661d0d5e4b4ac98b2e','0ff75da7b8b012bc14f33d41baaa256c','6d22236c3cdf1ab550084875b9a8e318','456ab55e8f35e1553d0c0a551aa6a4b5','4ce6b705f129a3eb670084f6ccc8d5c9','b07868b7c4e3503c3e47faaa5d435d98','4e53ce07ed29585aa0e70c9d46698404','08080fb57c5541b3f6010f89f3ea7bc5','7da48f50f79381f4af7ecf3e33baf5ab','cf64900179fa1944164eaab2c08102de','cab250545ac0a7c9b119e5f233cc61b6','fbfc5cb0fe740916c9e2660b9b23dd6c','bd74c566f9f3a5ef01858f40281b8fa6','41f9deb39c43268ecd4f9bc4a7ee857b','565ce753b1679eb3527265355969d9d5','974272d32829e04302cc3745a748ed02','9c679c9e746ffbbda4369aa878b453a8','62cf5205ab5225de6542bbd538820192') and p.id in (select pid from shop_product_relation where cid in ('006006002000000','006006003000000','006006004000000','006006005000000','006006006000000','006009008000000','006009010000000','006009012000000','006011002000000','006011003000000','006011004000000','006011005000000','006011006000000','006011007000000','006011008000000','006011009000000','006011010000000','006011011000000','006011012000000','006012001000000','006012002000000','006012003000000','006012004000000','006012005000000','006012006000000','006012007000000','006012008000000','006012009000000','006012010000000','006012011000000','006012012000000','006012013000000','006012014000000','006012015000000','006012016000000','006012017000000','006013001000000','006013002000000','006013003000000','006013004000000','006013005000000','006013006000000','006013007000000','006013008000000','006014002000000','007006008000000','007007009000000','004009019000000','004009020000000','004009021000000','000003013000000','008010004000000','005009001000000','005010001000000','017001001000000','017001002000000','017001003000000','017001004000000','017001005000000','017001006000000','017001007000000','017002001000000','017002002000000','017002003000000','017002004000000','017002005000000','017002006000000','017003001000000','017003002000000','017003003000000','017003004000000','017003005000000','017003006000000','017003007000000','017003008000000','017003009000000','017003010000000','017003011000000','017004001000000','017004002000000','017004003000000','017004004000000','017004005000000','017004006000000','017005001000000','017005002000000','017005003000000','017005004000000','017005005000000','017005006000000','017005007000000','017005008000000','017005009000000','017005010000000','017005011000000','017005012000000','017006001000000','017006002000000','017006003000000')) order by p.id";
*/



//and p.id not in (select pid from sellertool_log where result_code='200') 



$db->query($sql);

$pinfo="";
if($db->total){
	$pinfo=$db->fetchall("object");
	foreach($pinfo as $pi){
		array_push($array_pid,$pi[id]);
	}
}


$result = array_unique($array_pid);


//$OAL = new OpenAPI('halfclub');
//$OAL->lib->set_error_type("return");

$OAL = new OpenAPI('auction');

if(count($result)){
	foreach($result as $pid){
		$resulte = $OAL->lib->registGoods($pid,'');

		//echo $pid."|".$resulte->message."<br/>";
		//syslog(1,"SELLERTOOL - " . $pid . "|" . $resulte->message);
		$fh = date("H-i-s")."|". $pid . "|" . $resulte->message . chr(13);
		fwrite($fp, $fh);

	}
}


$fh = '---------------------  END  ---------------------' . chr(13) . chr(13);
fwrite($fp, $fh);
fclose($fp);



/*

select p.id , pr.cid,halfclub_code from 
	shop_product_relation pr ,
	shop_product p ,
	common_company_detail ccd ,
	shop_delivery_template dt ,
	shop_product_delivery pd
where 
	p.id=pr.pid
	and p.admin=ccd.company_id
	and p.state in ('1','0') 
	and p.disp='1'
	and ccd.halfclub_code !=''
	and dt.company_id = (case when p.delivery_type ='1' then '362ed8ee1cba4cc34f80aa5529d2fbcd' else p.admin end)
	and dt.is_basic_template='1' 
	and dt.product_sell_type='R' 
	and pd.pid=p.id 
	and pd.is_wholesale='R'
	and dt.dt_ix = pd.dt_ix
	and pr.cid in ('001002001000000','001002004000000','001002003000000','001002002000000','001012002000000','001012003000000','001012006000000','001012012000000','001012005000000','001012013000000','001003003000000','001003001000000','001003002000000','001003004000000','001003006000000','001001004000000','001001006000000','001001001000000','001001005000000','001001002000000','001013007000000','001013011000000','001013001000000','001007001000000','001006001000000','001006008000000','001006012000000','001006009000000','001006010000000','001006006000000','001006007000000','001009001000000','001010006000000','001010001000000','001008007000000','001008001000000','001008002000000','001008008000000','001008004000000','001011003000000','001005008000000','001005007000000','001005005000000','001005006000000','001004002000000','001004001000000','001004004000000','001014001000000','006004003000000','006004009000000','006009004000000','006009011000000','006009009000000','006009001000000','006010002000000','006010011000000','006010003000000','006010007000000','006010009000000','006010008000000','006010006000000','006014001000000','006014003000000','006014005000000','006014006000000','006011001000000','010006001000000','010006007000000','010006013000000','010006014000000','010006002000000','010006003000000','010006005000000','010006010000000','010006012000000','010006016000000','010006009000000','010006008000000','010006004000000','010006011000000','010006006000000','010015004000000','010015017000000','010015018000000','010015011000000','010015010000000','010001004000000','010001002000000','010002006000000','010002009000000','010002015000000','010002011000000','010002008000000','010002001000000','010002004000000','010002013000000','010002016000000','010017014000000','010017017000000','010017005000000','010017006000000','010017013000000','010017009000000','010017003000000','010010009000000','010010006000000','010010007000000','010010003000000','010010004000000','010010002000000','010008006000000','010008007000000','010008004000000','010003005000000','010003003000000','010003009000000','010003006000000','010003013000000','010003012000000','010003008000000','010003007000000','010003001000000','010003010000000','010007011000000','010007002000000','010007009000000','010007007000000','010018003000000','010018001000000','010018002000000','010011006000000','010011009000000','010011011000000','010011002000000','010011007000000','010011013000000','010013001000000','010013003000000','010016014000000','010016005000000','010016002000000','010016011000000','010016001000000','010016009000000','010012011000000','010012010000000','010012001000000','010012002000000','010012013000000','010012014000000','010012012000000','010005007000000','010005009000000','010005013000000','010005014000000','010005002000000','010005012000000','010005005000000','010005006000000','010004007000000','010004014000000','010004013000000','010004011000000','010004003000000','010004017000000','010004006000000','010004016000000','010004009000000','010004015000000','010009008000000','010009003000000','010009002000000','010009001000000','010019006000000','010019003000000','009002011000000','009010002000000','009010003000000','009010001000000','009005002000000','009005003000000','009005004000000','009003006000000','009003001000000','009003008000000','007011003000000','007007001000000','007007003000000','007007008000000','007007002000000','007003003000000','007003001000000','007003002000000','007008010000000','007008001000000','007008008000000','007009002000000','007005002000000','007005003000000','007006007000000','007006006000000','007010004000000','004006001000000','004006003000000','004009009000000','004009015000000','004002004000000','004002001000000','004004014000000','004004016000000','004004007000000','004008001000000','004008003000000','004008005000000','004008004000000','004008002000000','004005006000000','004005004000000','004007001000000','004007002000000','004003004000000','004003003000000','000006010000000','000006008000000','000002009000000','000002001000000','000002008000000','000001009000000','000001003000000','000005006000000','000004008000000','000009006000000','000009003000000','000008009000000','000008002000000','000003009000000','000003001000000','000003008000000','008011001000000','008010003000000','008010002000000','008010001000000','008001004000000','008001012000000','008006006000000','008003001000000','008009012000000','008009001000000','008009006000000','008009010000000','008002023000000','008002001000000','008002015000000','008008008000000','008008009000000','005002001000000','005005006000000','005005002000000','005005004000000','005003006000000','005006001000000','005006005000000','005013007000000','005007002000000','005007001000000','005011010000000','005004005000000','003013003000000','003013001000000','003013004000000','003012008000000','003008007000000','003008011000000','003008004000000','003010006000000','003001009000000','003001013000000','003001008000000','003002009000000','003002008000000','003007008000000','003007013000000','003004017000000','003004021000000','003004016000000','003004012000000','003004006000000','003004018000000','003005014000000','003006010000000','003006006000000','003009002000000','003003008000000','003003004000000','003003011000000','003014001000000','003011005000000','002006007000000','002006004000000','002006001000000','002008001000000','002008005000000','002008007000000','002008010000000','002005008000000','002005001000000','002005009000000','002005003000000','002002001000000','002009006000000','002009005000000','002009002000000','002009001000000','002009003000000','002003005000000','002003006000000','002003010000000','002003003000000','002003001000000','002003004000000','002003002000000','002004001000000','002001002000000','002001005000000','002001006000000','002001004000000','002001009000000','002001001000000','002007002000000','002007001000000')

group by pr.cid


나한테 메일쓰기!



로그 확인!
http://daisomall.co.kr/cron/sellertool_putgoods.cron.php?check=1


6번서버에서만 돌려야함

nohup lynx --dump 'http://daisomall.co.kr/cron/sellertool_putgoods.cron.php' &

쁘띠 접속정보

183.111.154.6		22

root


*/
?>