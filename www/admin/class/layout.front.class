<?
header('P3P:CP="IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT"');
header("Content-type: text/html; charset=utf-8");
//session_start();
include("$DOCUMENT_ROOT/class/database.class");
include("$DOCUMENT_ROOT/class/Template_.class.php");
include("$DOCUMENT_ROOT/admin/lib/control.php");
include("$DOCUMENT_ROOT/include/global_util.php");
include("$DOCUMENT_ROOT/include/lib.function.php");
include("$DOCUMENT_ROOT/admin/v3/include/menu.php");
include("$DOCUMENT_ROOT/admin/include/admin.util.php");

include("$DOCUMENT_ROOT/admin/include/design.tmp.php");
include("$DOCUMENT_ROOT/admin/class/poplayout.class");
include("$DOCUMENT_ROOT/admin/class/mobilelayout.class");
include_once("$DOCUMENT_ROOT/bbs/bbs.php");

if(substr_count($_SERVER["HTTP_HOST"],"m.") || $type == "mobile" || substr_count($_SERVER["HTTP_USER_AGENT"],"Mobile") ){
	$agent_type = "mobile";
}

global $admin_root;
$admin_root = "/admin";

global $admin_config, $layout_config, $admininfo;

if($admininfo[admin_level] < 7 || !$admininfo){
	if($mmode == "pop"){
		echo "<script>alert('관리자 로그인후 사용해주세요');self.close();</script>";
	}else{
		echo "<script>alert('관리자 로그인후 사용해주세요');document.location.href='/admin/admin.php'</script>";
	}
}

class LayOut{
	var $strContents;
	var $addScript;
	var $OnloadFunction;
	var $title;
	var $strLeftMenu;
	var $default_path;
	var $BodyFunctionAdd;
	var $Config;
	var $Navigation;
	var $admin_home_link;
	var $prototype_use;
	var $jquery_use;
	var $right_menu;
	var $TitleBool ;
	var $ServiceInfoBool;
	var $RightMenuBool;
	var $LeftMenuBool;
	var $ContentsDefaultPadding;
	var $footer_menu ;

	function LayOut(){
		global $admin_root;

		$this->strContents = "";
		$this->addScript = "";
		$this->OnloadFunction = "";
		$this->BodyFunctionAdd = "";
		$this->title = "";
		$this->strTopMenu = "";
		$this->strLeftMenu = "";
		$this_host = array( 'unimind.kr', 'www.unimind.kr', 'demo.unimind.kr');
		if(in_array($_SERVER["HTTP_HOST"],$this_host)){
			$this->default_path = $admin_root;
		}else{
			$this->default_path = $admin_root;
		}
		$this->Navigation = "HOME";
		//$this->admin_home_link = $this->default_path."/store/main.php";
		if($_SESSION["admininfo"]["mem_type"]=="S" || $_SESSION["admininfo"]["mem_type"]=="MD") {//kbk 셀러와 셀러메니저가 로그인 시 홈 경로 변경 11/11/09
			$this->admin_home_link = $this->default_path."/seller/index.php";
		}else if($_SESSION["admininfo"]["mem_type"]=="CS") {//kbk 가맹점회원 로그인 시 홈 경로 변경 11/11/09
			$this->admin_home_link = $this->default_path."/chainstore/index.php";
		} else {
			$this->admin_home_link = $this->default_path."/store/main.php";
		}
		$this->theme_image_path = "/apps/images/orange/";
		$this->prototype_use = true;
		$this->jquery_use = false;
		$this->right_menu = $this->view_favorite();
		$this->TitleBool = true;
		$this->ServiceInfoBool = false;
		$this->RightMenuBool = true;
		$this->LeftMenuBool = true;
		$this->ContentsDefaultPadding = "1% 1%";


		

		//checkMenuAuth(md5($_SERVER["PHP_SELF"]));
		$this->AdminConfig();
	}

	function AdminConfig(){
	global $admin_config, $layout_config, $admininfo,$DOCUMENT_ROOT;
		if($admin_config[mall_data_root] == "" || true){
			$cfg_db = new Database;

			$sql = "select mall_use_templete,mall_use_mobile_templete, mall_page_type, mall_use_inventory, mall_domain, mall_use_multishop, mall_ename, mall_data_root , currency_unit
				from ".TBL_SHOP_SHOPINFO." where mall_ix = '".$admininfo[mall_ix]."' and mall_domain LIKE '".str_replace("www.","",$_SERVER["HTTP_HOST"])."%' ";
			//echo $sql;
			//exit;
			$cfg_db->query($sql);

			$cfg_db->fetch();

			$admin_config[mall_use_multishop] = $cfg_db->dt[mall_use_multishop];
			$admin_config[mall_use_templete] = $cfg_db->dt[mall_use_templete];
			$admin_config[selected_templete] = $cfg_db->dt[mall_use_templete];
			$admin_config[mall_use_mobile_templete] = $cfg_db->dt[mall_use_mobile_templete];
			$admin_config[minishop_templete] = "basic";
			if($admin_config[mall_page_type] == ""){
				$admin_config[mall_page_type] = "P";
			}
			$admin_config[mall_ename] = $cfg_db->dt[mall_ename];
			$admin_config[mall_data_root] = $cfg_db->dt[mall_data_root];
			$admin_config[mall_admin_root] = $DOCUMENT_ROOT.$this->default_path;
			$admin_config[mall_domain] = $cfg_db->dt[mall_domain];
			$admin_config[mall_use_inventory] = $cfg_db->dt[mall_use_inventory];
			$admin_config[currency_unit]  = $cfg_db->dt[currency_unit];



			$layout_config = $admin_config;
			$this->Config = $admin_config;
			session_register("admin_config");
			session_register("layout_config");
		}else{
			//print_r($admin_config);
			//exit;
		}
	}

	function PrintLayOut(){
	global $admininfo, $admin_config, $_COOKIE, $DOCUMENT_ROOT;

	$templet_path = $admin_config[mall_data_root]."/templet/".$admin_config[mall_use_templete];

	if($admininfo[admin_level] == 9){

	}else if($admininfo[admin_level] == 8){
		$permit_string = $admininfo[permit];
		//$this->admin_home_link = $this->default_path."/store/bbs.php";
	}

	if (file_exists("$DOCUMENT_ROOT".$admininfo[mall_data_root]."/images/admin_logo.gif")){
		$admin_logo_path = $admininfo[mall_data_root]."/images/admin_logo.gif";
	}else{
		$admin_logo_path = $this->default_path."/images/admin_logo.gif";
	}


	$this->strTopMenu = topmenu($this->default_path."/v3/images/topmenu"); //

	$mndb = new Database;
	$sql = "select * from admin_menus where menu_code = '".md5($_SERVER["PHP_SELF"])."' ";
	//echo $sql; //select * from admin_menus where menu_code = 'fd7e97d9d78693ee444eb486c0cd27cc'
	$mndb->query($sql);
	if(!$mndb->total){
		$paths = explode("/",$_SERVER["PHP_SELF"]);
		$navis = explode(">",str_replace("HOME > ","",$this->Navigation));

		$sql = "insert into admin_menus(menu_code,menu_div, menu_name,menu_path,menu_link, regdate)
			values
			('".md5($_SERVER["PHP_SELF"])."','".str_replace(" ","",$paths[2])."','".(count($navis[1]) >= 1 ? trim($navis[1]):trim($navis[0]))."','".str_replace("HOME > ","",$this->Navigation)."','".$_SERVER["PHP_SELF"]."',NOW())";
		echo $sql;
		$mndb->query($sql);
	}

	//print_r($admininfo);
	$paths = explode("/",str_replace($admin_root,"/admin",$_SERVER["PHP_SELF"]));

	if($admininfo["language"] != "korea"){
		$sql = "select text_div, text_korea, text_trans
			from admin_language
			where language_type = '".$admininfo["language"]."' and text_div in ('common','gnb','".str_replace(" ","",$paths[2])."_lnb')
			order by CHAR_LENGTH(text_korea) desc  ";
		//echo $sql;
		$mndb->query($sql);
		if($mndb->total){
		//echo "test";
			$languages = $mndb->fetchall();
			//print_r($dics);
			$count = 10;
			for($i=0;$i < count($languages);$i++){
				//echo $languages[$i]["text_korea"]."<br>\n";
				$this->strTopMenu = str_replace($languages[$i]["text_korea"], $languages[$i]["text_trans"], $this->strTopMenu);
				$this->strLeftMenu = str_replace($languages[$i]["text_korea"], $languages[$i]["text_trans"], $this->strLeftMenu);
				$this->right_menu = str_replace($languages[$i]["text_korea"], $languages[$i]["text_trans"], $this->right_menu);
			}
		}
	}
	$sql = "select text_korea, text_trans from admin_dic where menu_code = '".md5(str_replace($admin_root,"/admin",$_SERVER["PHP_SELF"]))."' and language_type = '".$admininfo["language"]."' and dic_type = 'WORD'
		union
		select text_korea, text_trans
		from admin_language
		where language_type = '".$admininfo["language"]."' and text_div in ('common','gnb','".str_replace(" ","",$paths[2])."_lnb')
		order by CHAR_LENGTH(text_korea) desc
		 ";
	//echo $sql;
	$mndb->query($sql);
	if($mndb->total){
	//echo "test";
		$dics = $mndb->fetchall();
		//print_r($dics);
		$count = 10;
		for($i=0;$i < count($dics);$i++){
			$pattern = "[".$dics[$i]["text_korea"]."]";
			//$this->strContents = preg_replace($pattern, $dics[$i]["text_trans"], $this->strContents,$count);
			$this->strContents = str_replace($dics[$i]["text_korea"], $dics[$i]["text_trans"], $this->strContents);
		}
	}

$mstring = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">
<!--<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//ENg\">-->
<!--<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">-->
<html xmlns=\"http://www.w3.org/1999/xhtml\">
<head>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
<meta http-equiv='cache-control' content='no-cache'>
<meta http-equiv='pragma' content='no-cache'>
<meta http-equiv='X-UA-Compatible' content='IE=EmulateIE8'/>
<meta http-equiv='X-UA-Compatible' content='IE=7, IE=9'>

	<title></title>
</head>
<LINK REL='stylesheet' HREF='".$this->default_path."/v3/include/admin.css?".rand()."' TYPE='text/css'>
<!--LINK REL='stylesheet' HREF='/css/design.css' TYPE='text/css'-->
<LINK REL='stylesheet' HREF='".$this->default_path."/css/design.css' TYPE='text/css'>
<LINK REL='stylesheet' HREF='".$this->default_path."/common/css/design.css' TYPE='text/css'>
<LINK href='".$this->default_path."/css/facebox2.css' type='text/css' rel='stylesheet'>
<link rel='stylesheet' type='text/css' href='".$this->default_path."/v3/css/class.css' />
<link rel='stylesheet' type='text/css' href='".$this->default_path."/v3/css/common.css' />
<STYLE>";

$mstring .= "
body{margin:0px;}
</STYLE>
<script language='javascript'>
var language = \"".$admininfo[language]."\";
var permit = \"permit:".$permit_string."\";
</script>";

$mstring .= "<script language='JavaScript' src='".$this->default_path."/js/jquery-1.4.js'></Script>
<script language='javascript' src='".$this->default_path."/js/jquery.blockUI.js'></script>
<script language='javascript' src='".$this->default_path."/js/jquery.cookie.js'></script>
<script language='JavaScript' src='".$this->default_path."/js/admin.js'></Script>
<!--script language='JavaScript' src='".$this->default_path."/js/zoom.js'></Script-->
<script language='JavaScript' src='".$this->default_path."/js/auto.validation.js'></Script>
<script language='JavaScript' src='".$this->default_path."/js/dd.js'></Script>
<script language='JavaScript' src='".$this->default_path."/_language/language.js'></Script>
<script language='JavaScript' src='".$this->default_path."/_language/language.php'></Script>
<script language='JavaScript' >

$(function(){
    $(window).resize(function(){

        var width = parseInt($(this).width());
	//alert(width);
        //$('#wrapper').text(width);
	/*
        if (width < 1024) {
		$('#ServiceInfoArea').hide();
	//	$('#RightMenuArea').hide();
       } else if (width > 1024 && width < 1280) {
		$('#ServiceInfoArea').hide();
		$('#RightMenuArea').show();
       } else if (width > 1280 && width < 1480)  {
		$('#ServiceInfoArea').hide();
		$('#RightMenuArea').show();
	} else if (width > 1480)  {
		$('#ServiceInfoArea').show();
		$('#RightMenuArea').show();
        }
	*/

    }).resize(); // 로딩되면서 창크기에 맞추기 위해 한 번 부름
});


</Script>
<style type='text/css'>
	a img {
		border: none;
	} #largeImage {
		position: absolute;
		padding: .5em;
		background: #e3e3e3;
		border: 1px solid;
	}
</style>
".$this->addScript."
<body topmargin=0 leftmargin=0 rightmargin=0 bottommargin=0 style='height:90%'  ".$this->BodyFunctionAdd." onload=\"".$this->OnloadFunction."\"  ><!-- -->
<div style='min-width:1300px;'>
<table cellpadding='0' cellspacing='0' border='0' width='100%' >
	<tr>
		<td class='top_menu_area' align='left'>
			<table cellpadding='0' cellspacing='0' border='0' width='100%' >
				<col width='*' />
				<col width='40%' />
				<tr>
					<td>
						<div class='left_menu01'>";
				if(substr_count($_SERVER["HTTP_HOST"],"unimind.kr")){
					$mstring .= "	<a href='/admin/work/'><img src='".$this->default_path."/v3/images/unimind/unimind_logo.gif' alt='유니마인드' title='유니마인드' /></a>";
				}else{
					$mstring .= "	<a href='/admin/store/'><img src='".$this->default_path."/v3/images/common/logo_img01.gif' alt='몰스토리' title='몰스토리' /></a>";
				}
				$mstring .= "	<img src='".$this->default_path."/v3/images/common/logo_img02.gif' alt='관리자' title='관리자' />";
				
				$mstring .= "	
						</div>
					</td>
					<td align='right' nowrap>
						<div class='top_menu' >
							<ul>
								<li class='top_menu_list01'>
									[".$admininfo[company_name]."] ".$admininfo[admin_id]." 님
								</li>
								<li>
									<a href='".$this->default_path."/admin.php?act=logout'><img src='".$this->default_path."/v3/images/btns//logout_btn.gif' alt='로그아웃' title='튜토리얼모드' /></a>
								</li>
								<li class='top_menu_list01'>
									<a href='/' target=_blank>마이스토어</a>
								</li>
								<!--li class='top_menu_list01'>ㅣ</li>
								<li class='top_menu_list01'>
									<a href='/admin/myservice/'>마이서비스</a>
								</li-->
								<!--li class='top_menu_list01'>ㅣ</li>
								<li class='top_menu_list01'>
									<a href='#'>도움말</a>
								</li-->
							</ul>
						</div>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr><td class='topmenu_bg01'></td></tr>
	
	<tr>
		<td>

			<table cellpadding='0' cellspacing='0' border='0' width='100%' >

				<tr>
					<td width='180' align='center' class='sub_area' valign='top' id='admin_left_menu' rowspan=2 ".((!$this->LeftMenuBool || $_COOKIE[HIDE_MENU] == "N") ? "style='display:none'":"").">
						<div style='padding:10px 0;display:none;'>
							<img src='".$this->default_path."/v3/images/btns//order_btn01.gif' alt='주문관리' title='주문관리' />
						</div>
						<div class='close_btn01'>

						</div>
						<div style='padding:10px 10px 5px 10px;'>
							".$this->strLeftMenu."
						</div>";

			if($admininfo[admin_level] == 9 && substr_count($_SERVER["PHP_SELF"],"/admin/design")){
			$mstring .= "	<table align=center width='100%' cellpadding=2 cellspacing=0>
							<tr>
								<td style='padding:0px 3px 0px 10px ;' align=left>
								<!--a href=\"javascript:\" onclick=\"window.open('/admin/design/category.php','win_category','width=860,height=428');\"-->
								<a href=\"/admin/design/category_frame.php\" rel='facebox' ><img src='../images/".$admininfo['language']."/btn_make_design2.gif'></a>
								</td>
							</tr>
						</table>";
						$mstring .= "	<table align=center width='100%' cellpadding=2 cellspacing=0>
							<tr>
								<td style='padding:5px 3px 3px 10px ;' align=left>
								<!--a href=\"javascript:\" onclick=\"window.open('/admin/design/category.php','win_category','width=860,height=428');\"-->
								<a href=\"javascript:PoPWindow3('/admin/manual/manual_ftp.php',800,800,'contact_info')\"><img src='../images/".$admininfo['language']."/btn_ALFTP_upload.gif'></a>
								</td>
							</tr>
						</table>";
			}
			$mstring .= "
					</td>
					<td rowspan=2  style='width:7px;border-right:1px solid silver;vertical-align:top;padding-top:200px;background-color:#efefef;cursor:hand;' onclick=\"MenuHidden();\" onmouseover=\"$(this).css('background-color','silver');\" onmouseout=\"$(this).css('background-color','#efefef');\"><img src='".$this->default_path."/v3/images/btns//sub_arrowbox_".($_COOKIE[HIDE_MENU] == "N" ? "right":"left").".png' left_btn='".$this->default_path."/v3/images/btns//sub_arrowbox_left.png' right_btn='".$this->default_path."/v3/images/btns//sub_arrowbox_right.png' id='left_hidden_btn' alt='' title='' /></td>
					<td class='banner01' style='display:none;'>
						<table width=100% cellpadding=0 cellspacing=0>
							<col width='50px'>
							<col width='*'>
							<col width='50px'>
							<tr>
								<td></td>
								<td><img src='".$this->default_path."/v3/images/common/banner01.gif' alt='' title='' style='padding:0;margin:0;line-height:0;font-size:1px;background:red;'/></td>
								<td><img src='".$this->default_path."/v3/images/btns//close_btn.gif' alt='' title='' onclick=\"$('.banner01').toggle();\" style='cusor:pointer;'/></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td width='*'  valign='top'>						
						<table cellpadding='0' cellspacing='0' border='0' width='100%' style='min-width:1100px;border:0px solid red;'>
							<!--col width='*' />
							<col width='242' /-->
							<tr>
								<td width='*' align='left' class='box_border' style='border-left:0;' valign='top'>";
									if($this->TitleBool){
									$mstring .= "
									<div style='text-align:left;border-bottom:solid 1px #c5c5c5;'>
										<table cellpadding='0' cellspacing='0' border='0' width='100%' >
											<tr>
												<td>
													<div class='icon_title01'>
													<span style='color:#000000;'>".$this->title."</span>
													<a href='/admin/favorite.act.php?act=add&page_id=".md5($_SERVER["PHP_SELF"])."&favorite_link=".urlencode($_SERVER["REQUEST_URI"])."&favorite_name=".urlencode($this->title)."' target='iframe_act' class=small><img src='".$this->default_path."/v3/images/btns/bookmark_btn.gif' alt='즐겨찾기추가' title='즐겨찾기추가' style='position:relative;top:3px;' /></a>
													</div>
												</td>
												<td align='right'>
													<div style='margin:35px 10px 5px 0;'>
														".$this->Navigation." <img src='".$this->default_path."/images/icon_q.gif' style='cursor:pointer;' align=absmiddle onclick=\"HelpView()\">
													</div>
												</td>
											</tr>
										</table>
									</div>";
									}

									$mstring .= "
									<div style='".($this->ContentsDefaultPadding != "" ? "margin:".$this->ContentsDefaultPadding:"").";padding-bottom:75px;' id='contents_frame'>
										".$this->strContents."
									</div>
								</td>
								<td height=700></td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td style='background:#303030;padding:15px 0;'>
			<table cellpadding='0' cellspacing='0' border='0' width='100%' >
				<col width='70%' />
				<col width='30%' />
				<col width='1%' />
				<tr>
					<td>";


					if($this->footer_menu == ""){
					$mstring .= "
						<ul class='footer_list'>
							<li>
								<a href='http://www.mallstory.com/intro/' target=_blank>몰스토리</a>
							</li>
							<li style='color:#ffffff;'> ㅣ </li>
							<li>
								<a href='http://www.mallstory.com/shop/' target=_blank>디자인</a>
							</li>
							<li style='color:#ffffff;'> ㅣ </li>
							<li>
								<a href='http://www.mallstory.com/marketing/' target=_blank>마케팅</a>
							</li>
							<li style='color:#ffffff;'> ㅣ </li>
							<li>
								<a href='http://www.mallstory.com/addservice/' target=_blank>부가서비스</a>
							</li>
							<li style='color:#ffffff;'> ㅣ </li>
							<li>
								<a href='http://www.mallstory.com/customer/' target=_blank>고객센터</a>
							</li>
							<li style='color:#ffffff;'> ㅣ </li>
							<li>
								<a href='http://www.mallstory.com/customizing/' target=_blank>맞춤제작/이전</a>
							</li>
							<li style='color:#ffffff;'> ㅣ </li>
							<li>
								<a href='http://www.mallstory.com/customer/bbs.php?board=notice' target=_blank>공지사항 <img src='".$this->default_path."/v3/images/btns//new_icon.gif' alt='' title='' /></a>
							</li>
							<!--li> ㅣ </li>
							<li>
								<a href='#'>도움말</a>
							</li-->
						</ul>";
					}else{
					$mstring .= $this->footer_menu;
					}

					$mstring .= "
					</td>
					<td style='color:#ffffff;' style='text-align:right;'>
						Copyright ⓒ <strong>Mallstory</strong>. All Rights Reserved.
					</td>
					<td style='text-align:right;' align=right>

						
					</td>
				</tr>
			</table>
		</td>
	</tr>
</table>
</div>
<div id='loading' style='display:none;border:0px solid red;width:100px;height:100px;padding-top:13px;text-align:center;'><img src='../images/loading_large.gif' border=0></div>
<div id='layerBg' style='border:0px solid gray;'></div>
<iframe name='act' id='act' style='display:none;'></iframe>
<iframe name='iframe_act' id='iframe_act' width=0 height=0 frameborder=0 style='display:none;'></iframe>
<iframe name='bs_site_frame' id='bs_site_frame' width='0%' height='0px' frameborder=0></iframe>
</body>
<script>
//linecss();
</script>
<script>
	//$.blockUI.defaults.css = {}; 
	//$.blockUI({ message: $('#loading'), css: { width: '100px' , height: '100px' ,padding:  '10px'} });  
</script>
<script language='JavaScript' src='".$this->default_path."/js/admin_bottom.js'></Script>
<script language='JavaScript' src='".$this->default_path."/v3/js/menus_layer.js'></Script>
<script language='JavaScript' src='".$this->default_path."/v3/include/menus_data.php'></Script>
<script type='text/javascript' language=javascript src='".$this->default_path."/js/facebox.js'></script>
<script type='text/javascript' src='".$this->default_path."/js/jquery.numeric.js'></script>
<script language='javascript'>
$('.numeric').numeric();
$('.integer').numeric(false, function() { alert(integer_only); this.value = ''; this.focus(); });
$('.positive').numeric({ negative: false }, function() { alert(no_nagative_values); this.value = ''; this.focus(); });
$('.positive-integer').numeric({ decimal: false, negative: false }, function() { alert('Positive integers only'); this.value = ''; this.focus(); });
$('#remove').click(
	function(e)
	{
		e.preventDefault();
		$('.numeric,.integer,.positive').removeNumeric();
	}
);
</script>
</html>";
/*
for($i=0;$i < count($languages);$i++){
	$mstring = str_replace($languages[$i]["text_korea"], $languages[$i]["text_trans"], $mstring);
}
*/
for($i=0;$i < count($dics);$i++){
	$mstring = str_replace($dics[$i]["text_korea"], $dics[$i]["text_trans"], $mstring);
}


echo $mstring;
//echo "<table border=1 width=100% height=100%><tr><td></td></tr></table>";

	}

	function view_favorite(){
		global $admininfo;
		$mdb = new Database;

		if(!$mdb->mysql_table_exists("shop_admin_favorite")){
			$sql = "CREATE TABLE `shop_admin_favorite` (
			  `favorite_ix` int(4) unsigned NOT NULL auto_increment,
			  `company_id` varchar(32) NOT NULL default '',
			  `charger_id` varchar(30) NOT NULL default '',
			  `page_id` varchar(32) default NULL,
			  `favorite_name` varchar(255) default NULL,
			  `favorite_link` varchar(255) default NULL,
			  `view_order` int(4) default '1',
			  `regdate` datetime default NULL,
			  PRIMARY KEY  (`favorite_ix`)
			) ENGINE=MyISAM  DEFAULT CHARSET=utf8 COMMENT='관리자 즐겨찾기테이블'";
			$mdb->query($sql);
		}

		$sql = "select * from shop_admin_favorite where company_id = '".$admininfo["company_id"]."' and charger_id = '".$admininfo["admin_id"]."'  ";
		//echo $sql;
		$mdb->query($sql);
		$mstring .="<div style='text-align:left;'>
			<table cellpadding='0' cellspacing='0' border='0' width='95%' style='margin:0 0px;' class='service_box'>";
		//$mstring .="<tr><td  nowrap><b>즐겨찾기 메뉴</b></td></tr>";

		if($mdb->total){
			for($i=0;$i < $mdb->total;$i++){
				$mdb->fetch($i);
				$mstring .= "<tr>
							<td align=left style='padding:0 0 0 5px' nowrap>
								<a href='".$mdb->dt[favorite_link]."' class='small'> <img src='/admin/images/icon/dot_orange.gif' align=absmiddle> ".$mdb->dt[favorite_name]."</a>
							</td>
							<td nowrap>
								<a href='/admin/favorite.act.php?act=delete&page_id=".$mdb->dt[page_id]."' target='iframe_act' class='small'><img src='".$this->default_path."/v3/images/btns/close_btn.gif'></a>
							</td>
						</tr>";
				//$mstring .= "<tr><td colspan=2 class=dot-x></td></tr>";
			}
		}else{
			$mstring .= "<tr height=30><td colspan=2 nowrap>추가된 즐겨찾기 메뉴가 없습니다.</td></tr>";
		}
		$mstring .="</table>
		</div>
		<table cellpadding='0' cellspacing='0' border='0' width='100%' class='title_area'>
			<tr>
				<td align='left'>
					<img src='".$this->default_path."/images/dot_org.gif' align=absmiddle> <b class='middle_title'>한줄 메모하기</b>
				</td>
			</tr>
		</table>
		<div id='work_tmp_box' style=''>
			<div id='work_tmp_input' class='memo_box' style='border:0px solid red;width:220px;padding:3px 0px;'>
			<input type=text name='work_memo' id='work_memo' style='border:0;background:transparent;width:200px;margin-top:2px;padding:4px 0;margin-left:10px;font-size:13px;' title='입력후 엔터키를 누르세요'>
			</div>
			<div id='external-events' style='width:95%;'>";

$sql = "SELECT wt_ix, work_tmp_title FROM work_tmp  where charger_ix = '".$admininfo[charger_ix]."' order by regdate desc";
//	echo $sql;
$mdb->query($sql);
	$mstring .= "<div class='external-event' wt_ix='' style='display:none;'></div>";
if(!$mdb->total){
		$mdb->fetch($i);
		$mstring .= "<div class='external-event' >메모를 남기실수 있습니다. 더블클릭시 메모가 삭제 됩니다</div>";
}else{
	for($i=0;$i < $mdb->total;$i++){
		$mdb->fetch($i);
		$mstring .= "<div class='external-event' wt_ix='".$mdb->dt[wt_ix]."' id='event_".$mdb->dt[wt_ix]."' ondblclick=\"work_tmp_delete('event_".$mdb->dt[wt_ix]."');\">".$mdb->dt[work_tmp_title]."</div>";
	}
}
	$mstring .= "	<p>";
	if($admininfo[use_work] == "Y"){
	$mstring .= "	<input type='checkbox' id='drop-remove' checked /> <label for='drop-remove'>스케줄 등록후 삭제</label>";
	}
	$mstring .= "
			</p>
			</div>
			<div style='display:none;'>Selected keys: <span id='echoSelection3'>-</span></div>
			<div style='display:none;'>Selected root keys: <span id='echoSelectionRootKeys3'>-</span></div>
			<div style='display:none;'>Selected root nodes: <span id='echoSelectionRoots3'>-</span></div>
		</div>";

$mstring .= "";
		return $mstring;
	}

}


/*
// 문자열 자르기
function cut_str($str,$len){

  if(strlen($str) < $len) return $str;

  $str = substr($str, 0, $len);
  $j = 0;

  for($i = strlen($str) - 1; $i >= 0; $i--) {
       if(ord($str[$i]) <= 127) break;
       $j++;
  }

  $str = ($j % 2) ? substr($str, 0, strlen($str) - 1) : $str;

  $str .= "...";

  return $str;
}
*/



function PrintBoardSummary(){
	global $db, $mdb;

	$sql = "select * from bbs_manage_config  where board_style = 'bbs' and recent_list_display = 'Y' ";
	//echo $sql ;
	$mdb->query($sql);
	$total = $mdb->total;
	$max = 7;

	//echo $total;

	if ($page == ''){
		$start = 0;
		$page  = 1;
	}else{
		$start = ($page - 1) * $max;
	}

	$mString = "<table cellpadding=4 cellspacing=0 width=100% style='table-layout:fixed;' class='list_table_box'>";
	$mString .= "<tr align=center bgcolor=#efefef height=30 style='font-weight:bold;'>
		<td width='22%' class='s_td'>게시판</td>
		<td width='45%' class='m_td'>제목</td>
		<td width='10%' class='m_td'>작성자</td>
		<td width='13%' class='m_td'>등록일</td>
		<td width='10%' class='e_td'>조회수</td>
		</tr>";
	//$mString = $mString."<tr align=center bgcolor=#efefef height=30><td class=s_td width='20%'>게시판</td><td class=m_td width='40%'>제목</td><td class=m_td width='10%'>작성자</td><td class=m_td width='20%'>등록일</td><td class=e_td width='10%'>조회수</td></tr>";
	//echo ($mdb->total);
	if ($total == 0){
		$mString .= "<tr bgcolor=#ffffff height=150><td colspan=9 align=center>최근 게시물 내역이 존재 하지 않습니다..</td></tr>";
	}else{
		$j=0;

		$sql = "create temporary table IF NOT EXISTS bbs_tmp ENGINE = MEMORY ";

		for($j=0;$j < $mdb->total;$j++){
			$mdb->fetch($j);
			if($j == 0){
				$sql .= "select '".$mdb->dt[board_name]."          ' as board_name, '".$mdb->dt[board_ename]."               ' as board_ename,  bbs_ix, bbs_subject, bbs_name, bbs_hit, bbs_re_cnt, regdate, case when regdate > DATE_SUB(now(), interval 3 day) then 1 else 0 end as new from bbs_".$mdb->dt[board_ename]." limit 10   ";
			}else{
				$sql = "insert into bbs_tmp select '".$mdb->dt[board_name]."' as board_name,  '".$mdb->dt[board_ename]."' as board_ename,  bbs_ix, bbs_subject, bbs_name, bbs_hit, bbs_re_cnt, regdate, case when regdate > DATE_SUB(now(), interval 3 day) then 1 else 0 end as new from bbs_".$mdb->dt[board_ename]."  limit 10   ";
			}
			//echo $sql;
			$db->query($sql);
		}
		//echo $sql;
		//$db->query($sql);

		$db->query("select * from bbs_tmp order by regdate desc");

		$total = $db->total;
		$db->query("select * from bbs_tmp order by regdate desc limit $start , $max");


		if ($total == 0){
			$mString .= "<tr bgcolor=#ffffff height=150><td colspan=9 align=center>최근 게시물 내역이 존재 하지 않습니다..</td></tr>";
		}else{
			for($i=0;$i<$db->total;$i++){
				$db->fetch($i);

				//$no = $no + 1;

				$mString = $mString."<tr height=27 bgcolor=#ffffff align=center>
				<td bgcolor='#fbfbfb'>[".$db->dt[board_name]."]</td>
				<td align=left style='padding-left:20px;'><a href='/admin/bbsmanage/bbs.php?mode=read&board=".$db->dt[board_ename]."&bbs_ix=".$db->dt[bbs_ix]."'>".$db->dt[bbs_subject]."</a></td>
				<td bgcolor='#fbfbfb'>".$db->dt[bbs_name]."</td>
				<td>".str_replace("-",".",substr($db->dt[regdate],0,10))."</td>
				<td bgcolor='#fbfbfb'>".$db->dt[bbs_hit]."</td>
				<!--td align=center>
					<a href=JavaScript:deleteDisplayOption('delete','".$db->dt[dp_ix]."','$pid')><img  src='/admin/image/si_remove.gif' border=0></a>
				</td-->
				</tr>
				";
			}
		}
	}
	$mString = $mString."</table>";

	return $mString;
}


function PrintOrderSummary(){
	global $db, $admininfo;
	if($admininfo[admin_level] == 9){
		//$sql = "select o.* from (select * from ".TBL_SHOP_ORDER." o where o.status != 'SR' order by o.date desc  limit 0, 7) o, ".TBL_SHOP_ORDER_DETAIL." od where o.status != 'SR' and o.oid = od.oid  group by o.oid order by o.date desc limit 0, 7";
		//$sql = 'SELECT o.* FROM '.TBL_SHOP_ORDER.' o WHERE o.status != "SR" GROUP BY o.oid ORDER BY o.date DESC LIMIT 7';
		$sql = 'SELECT o.*,COUNT(od.oid) AS od_cnt
			FROM '.TBL_SHOP_ORDER.' o INNER JOIN '.TBL_SHOP_ORDER_DETAIL.' od ON od.oid = o.oid
			WHERE  o.status != "SR"
			GROUP BY o.oid ORDER BY o.date DESC LIMIT 7';
	}else{
		//$sql = "select o.* from ".TBL_SHOP_ORDER." o ,(select oid, company_id, regdate from ".TBL_SHOP_ORDER_DETAIL." od where od.company_id ='".$admininfo[company_id]."' and od.status != 'SR' order by oid desc limit 40) od where o.status != 'SR' and o.oid = od.oid and od.company_id ='".$admininfo[company_id]."' group by od.oid order by od.regdate desc limit 0, 7";
		$sql = 'SELECT o.*,COUNT(od.oid) AS od_cnt
			FROM '.TBL_SHOP_ORDER.' o INNER JOIN '.TBL_SHOP_ORDER_DETAIL.' od ON od.oid = o.oid
			WHERE od.company_id = "'.$admininfo[company_id].'" AND o.status != "SR"
			GROUP BY o.oid ORDER BY o.date DESC LIMIT 7';
	}
	$db->query($sql);

	//print_r($db->getrows());



	$mString = "<table cellpadding=0 cellspacing=0 width=100% bgcolor=silver class='list_table_box'>
		<col width='15%'>
		<col width='15%'>
		<col width='15%'>
		<col width='15%'>
		<col width='15%'>
		<col width='15%'>
		<col width='15%'>
		<tr align=center bgcolor=#efefef height=30 style='font-weight:bold;'>
		<td class='s_td' width=80>주문번호</td>
		<td class='m_td'>이름</td>
		<td class='m_td' nowrap>결제방법</td>
		<td class='m_td'>주문일자</td>
		<td class='m_td'>수량.</td>
		<td class='m_td' nowrap>주문총액</td>
		<td class='e_td' nowrap>관리</td>
		</tr>";

	if ($db->total == 0){
		$mString = $mString."<tr bgcolor=#ffffff height=150><td colspan=7 align=center>최근 매출내역이 존재 하지 않습니다..</td></tr>";
	}else{
		$i=0;
		for($i=0;$i<$db->total;$i++){
			$db->fetch($i);

			/*if ($db->dt[method] == "1")
			{
				if($db->dt[bank] == ""){
					$method = "카드결제";
				}else{
					$method = $db->dt[bank];
				}
			}elseif($db->dt[method] == "0"){
				$method = "계좌입금";
			}elseif($db->dt[method] == "2"){
				$method = "전화결제";
			}elseif($db->dt[method] == "4"){
				$method = "가상계좌";
			}elseif($db->dt[method] == "5"){
				$method = "계좌이체";
			}else{
				$method = "";
			}*/
			$method=getMethodStatus($db->dt[method]);

			$status = getOrderStatus($db->dt[status]);


			$mString = $mString."<tr height=25 bgcolor=#ffffff align=center>
			<td nowrap><a href='/admin/order/orders.read.php?oid=".$db->dt[oid]."'>".$db->dt[oid]."</a></td>
			<td nowrap>".$db->dt[bname]."</td>
			<td>".$method."</td>
			<td nowrap>".$db->dt[date]."</td>
			<!--td>".$status."</td-->
			<td>".$db->dt[od_cnt]."</td>
			<td class='point'>".number_format($db->dt[total_price],0)."</td>
			<td align=center valign=middle><a href=\"../order/orders.edit.php?oid=".$db->dt[oid]."\"><img src='../images/".$admininfo["language"]."/btn_modify.gif' border=0 align=absmiddle></a></td>
			</tr>
			";
		}
	}
	$mString = $mString."</table>";

	return $mString;
}

function PrintOrderSummary2(){
	global $mdb;






	$mString = "<table cellpadding=1 cellspacing=0 width=300 >";
	$mString = $mString."<tr align=center bgcolor=#efefef height=25><td class=s_td  style='border-right:1px solid gray;' colspan=3><b style='color:orange'>".date("Y 년 m 월 d 일") ."</b> <b>현황</b></td></tr>";



		$i=0;
			$sql = "select sum(total_price) as total_price ,count(oid) as order_cnt, sum(case when status = 0 then 1 else 0 end) as not_payment_cnt,
			sum(case when status = 1 then 1 else 0 end) as not_send_cnt
			from ".TBL_SHOP_ORDER." where static_date = '".(date("Ymd"))."' group by static_date  ";


			$mdb->query($sql);
			$mdb->fetch();


			$mString .= "
			<tr height=25 bgcolor=#ffffff align=center height=25>
			<td align=center bgcolor='#efefef' width='50%'>총 구매금액 :</td>
			<td>".returnZeroValue($mdb->dt[total_price])."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
			<td align=center bgcolor='#efefef'>총 구매 횟수 :</td>
			<td>".returnZeroValue($mdb->dt[order_cnt])."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
			<td align=center bgcolor='#efefef'>미결제건수 :</td>
			<td>".returnZeroValue($mdb->dt[not_payment_cnt])."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
			<td align=center bgcolor='#efefef'>미결제건수 :</td>
			<td>".returnZeroValue($mdb->dt[not_send_cnt])."</td>
			<td></td>
			</tr>";

			$sql2 = "select sum(case when code != '' then 1 else 0 end)  as reg_member_cnt
					from ".TBL_COMMON_USER." where substring(date,1,10) = '".date("Y-m-d")."'  ";
			$mdb->query($sql);
			$mdb->fetch();

			$mString .= "
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
			<td align=center bgcolor='#efefef'>미결제건수 :</td>
			<td>".returnZeroValue($mdb->dt[reg_member_cnt])."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			";

//	}
	$mString = $mString."</table>";

	return $mString;
}

function PrintOrderSummary3(){
	global $admininfo;
	$odb = new Database;

	$vdate = date("Ymd", time());
	$today = date("Ymd", time());
	$firstday = date("Ymd", time()-84600*date("w"));
	$lastday = date("Ymd", time()+84600*(6-date("w")));


	if($admininfo[admin_level] == 9){
		$sql = "Select
					sum(case when od.status in ('".ORDER_STATUS_INCOM_READY."','".ORDER_STATUS_INCOM_COMPLETE."','".ORDER_STATUS_DELIVERY_READY."','".ORDER_STATUS_DELIVERY_ING."','".ORDER_STATUS_DELIVERY_COMPLETE."')  and date_format(od.regdate,'%Y%m%d') =  '".date("Ymd",mktime(0,0,0,substr($vdate,4,2),substr($vdate,6,2),substr($vdate,0,4)))."' then ptprice else '0' end) as today_total_price,
					sum(case when od.status in ('".ORDER_STATUS_INCOM_READY."','".ORDER_STATUS_INCOM_COMPLETE."','".ORDER_STATUS_DELIVERY_READY."','".ORDER_STATUS_DELIVERY_ING."','".ORDER_STATUS_DELIVERY_COMPLETE."')  and date_format(od.regdate,'%Y%m%d') between '".$firstday."' and $lastday then ptprice else '0' end) as thisweek_total_price,
					sum(case when od.status in ('".ORDER_STATUS_INCOM_READY."','".ORDER_STATUS_INCOM_COMPLETE."','".ORDER_STATUS_DELIVERY_READY."','".ORDER_STATUS_DELIVERY_ING."','".ORDER_STATUS_DELIVERY_COMPLETE."')  and date_format(od.regdate,'%Y%m') = '".substr($vdate,0,6)."'  then ptprice else '0' end) as thismonth_total_price,
					sum(case when od.status in ('".ORDER_STATUS_CANCEL_APPLY."','".ORDER_STATUS_CANCEL_COMPLETE."')  and date_format(od.regdate,'%Y%m') = '".substr($vdate,0,6)."'  then ptprice else '0' end) as thismonth_cancel_total_price,
					sum(case when od.status = '".ORDER_STATUS_INCOM_READY."'  then 1 else '0' end) as ready_cnt,
					sum(case when od.status = '".ORDER_STATUS_INCOM_COMPLETE."'  then 1 else '0' end) as order_end_cnt,
					sum(case when od.status in ('".ORDER_STATUS_RETURN_APPLY."','".ORDER_STATUS_RETURN_COMPLETE."')  then 1 else '0' end) as thismonth_return_total_cnt
				 	from ".TBL_SHOP_ORDER_DETAIL." od LEFT JOIN ".TBL_SHOP_PRODUCT." p ON od.pid=p.id WHERE p.product_type NOT IN ('4','5','6')  ";
	}else if($admininfo[admin_level] == 8){
		$sql = "Select
					sum(case when od.status in ('".ORDER_STATUS_INCOM_READY."','".ORDER_STATUS_INCOM_COMPLETE."','".ORDER_STATUS_DELIVERY_READY."','".ORDER_STATUS_DELIVERY_ING."','".ORDER_STATUS_DELIVERY_COMPLETE."')  and date_format(date,'%Y%m%d') =  '".date("Ymd",mktime(0,0,0,substr($vdate,4,2),substr($vdate,6,2),substr($vdate,0,4)))."' then od.ptprice else '0' end) as today_total_price,
					sum(case when od.status in ('".ORDER_STATUS_INCOM_READY."','".ORDER_STATUS_INCOM_COMPLETE."','".ORDER_STATUS_DELIVERY_READY."','".ORDER_STATUS_DELIVERY_ING."','".ORDER_STATUS_DELIVERY_COMPLETE."')  and date_format(date,'%Y%m%d') between '".$firstday."' and $lastday then od.ptprice else '0' end) as thisweek_total_price,
					sum(case when od.status in ('".ORDER_STATUS_INCOM_READY."','".ORDER_STATUS_INCOM_COMPLETE."','".ORDER_STATUS_DELIVERY_READY."','".ORDER_STATUS_DELIVERY_ING."','".ORDER_STATUS_DELIVERY_COMPLETE."')  and date_format(date,'%Y%m') = '".substr($vdate,0,6)."'  then od.ptprice else '0' end) as thismonth_total_price,
					sum(case when od.status in ('".ORDER_STATUS_CANCEL_APPLY."','".ORDER_STATUS_CANCEL_COMPLETE."')  and date_format(date,'%Y%m') = '".substr($vdate,0,6)."'  then total_price else '0' end) as thismonth_cancel_total_price,
					sum(case when od.status = '".ORDER_STATUS_INCOM_READY."'  then 1 else '0' end) as ready_cnt,
					sum(case when od.status = '".ORDER_STATUS_INCOM_COMPLETE."'  then 1 else '0' end) as order_end_cnt,
					sum(case when od.status in ('".ORDER_STATUS_RETURN_APPLY."','".ORDER_STATUS_RETURN_COMPLETE."')  then 1 else '0' end) as thismonth_return_total_cnt
				 	FROM ".TBL_SHOP_ORDER." o, ".TBL_SHOP_PRODUCT." p, ".TBL_SHOP_ORDER_DETAIL." od
				 	where o.oid = od.oid and od.pid = p.id and p.admin = '".$admininfo[company_id]."' ";
		//echo $sql;
	}

//	echo $sql;
//	exit;


	$odb->query($sql);
	$odb->fetch();

	return "<table border=0 bgcolor='#c0c0c0' cellspacing=1 cellspacing=0 width=100%  ><!--bgcolor=#c0c0c0 -->
				<tr bgcolor=#ffffff>
					<th width=130 align=left class='leftmenu small' nowrap><img src='../image/title_head.gif'> <a href='../order/orders.list.php?type=".ORDER_STATUS_INCOM_READY."' style='color:red'><b>입금예정(처리대기)</b> </a> </th>
					<td 12% align=right style='padding-right:10px;'><b>".number_format($odb->dt[ready_cnt])." 건</b> </td>
				</tr>
				<tr bgcolor=#ffffff>
					<td  class='leftmenu small' align=left nowrap><img src='../image/title_head.gif'> <a href='../order/orders.list.php?type=".ORDER_STATUS_INCOM_COMPLETE."' style='color:red' ><b>입금확인(결제완료)</b></a> </td>
					<td  align=right 12%style='padding-right:10px;' ><b>".number_format($odb->dt[order_end_cnt])." 건</b> </td>
				</tr>
				<tr bgcolor=#ffffff>
					<th align=left class='leftmenu'><img src='../image/title_head.gif'>  오늘주문  </th>
					<td align=right 12%style='padding-right:10px;'>".number_format($odb->dt[today_total_price])." 원 </td>
				</tr>
				<tr bgcolor=#ffffff>
					<th align=left class='leftmenu'><img src='../image/title_head.gif'>  금주주문  </th>
					<td  align=right 12%style='padding-right:10px;' nowrap>".number_format($odb->dt[thisweek_total_price])." 원 </td>
				</tr>
				<tr bgcolor=#ffffff>
					<th align=left class='leftmenu'><img src='../image/title_head.gif'>  금월주문  </th>
					<td  align=right 12%style='padding-right:10px;' nowrap>".number_format($odb->dt[thismonth_total_price])." 원  </td>
				</tr>
				<tr bgcolor=#ffffff>
					<th align=left class='leftmenu'><img src='../image/title_head.gif'>  금월주문취소  </th>
					<td  align=right 12%style='padding-right:10px;'>".number_format($odb->dt[thismonth_cancel_total_price])." 원  </td>
				</tr>
				<tr bgcolor=#ffffff>
					<th align=left class='leftmenu'><img src='../image/title_head.gif'> <a href='../order/orders.list.php?type=r1'> 반품요청건수 </a></th>
					<td  align=right 12%style='padding-right:10px;'>".number_format($odb->dt[thismonth_return_total_cnt])." 건  </td>
				</tr>
			</table>
					";


}


function PrintLogSummary(){
	global $db, $mdb;



	$sql = "select ncnt from ".TBL_LOGSTORY_VISITTIME." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$visit = $db->dt[ncnt];

	$sql = "select ncnt from ".TBL_LOGSTORY_VISITOR." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$visitor = $db->dt[ncnt];

	$sql2 = "select sum(case when code != '' then 1 else 0 end)  as reg_member_cnt
			from ".TBL_COMMON_USER." where substring(date,1,10) = '".date("Y-m-d")."'  ";
	$mdb->query($sql);
	$mdb->fetch();

	$sql = "select ncnt from ".TBL_LOGSTORY_PAGEVIEWTIME." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$pageview = $db->dt[ncnt];

/*
	$sql = "Select r.cid, r.cname, sum(b.visit_cnt) as visit_cnt from ".TBL_LOGSTORY_REFERER_CATEGORYINFO." r, ".TBL_LOGSTORY_BYREFERER." b where b.vdate = '".date("Ymd")."' and substring(r.cid,1,9) = substring(b.vreferer_id,1,9) and r.cid LIKE '000001%' group by r.cid, r.cname order by visit_cnt  desc limit 0,1";
	$db->query($sql);
	$db->fetch();
	$referer_name = $db->dt[cname];
	$visitreferer = $db->dt[visit_cnt];
*/

	$sql = "select ncnt from ".TBL_LOGSTORY_PAGEVIEWTIME." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$pageview = $db->dt[ncnt];

	$mString = "<table cellpadding=4 cellspacing=0 border=0 width=250 >";
	$mString = $mString."<tr align=center bgcolor=#efefef height=25><td class=s_td  style='border-right:1px solid gray;' colspan=3><b >금일 접속자수 현황</b></td></tr>";

/*	if ($db->total == 0){
		$mString = $mString."<tr bgcolor=#ffffff height=50><td colspan=9 align=center>접속내역이  존재 하지 않습니다..</td></tr>";
	}else{
*/
			$mString = $mString."
			<tr height=25 bgcolor=#ffffff align=center height=25>
			<td align=center bgcolor='#efefef' width=100><a href='/admin/logstory/report/pageview1.php?SubID=SM114641Sub'>금일 페이지뷰 </a></td>
			<td>".returnZeroValue($pageview)."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
			<td align=center bgcolor='#efefef'><a href='/admin/logstory/report/visit.php?SubID=SM11464243Sub'>금일 방문횟수 </a></td>
			<td>".returnZeroValue($visit)."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
			<td align=center bgcolor='#efefef'><a href='/admin/logstory/report/visitor.php?SubID=SM1146487Sub'>금일 방문자수 </a></td>
			<td>".returnZeroValue($visitor)."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
			<td align=center bgcolor='#efefef'><a href='/admin/logstory/report/visitbyreferer.php?SubID=SM11464176Sub'>최다 유입사이트 </a></td>
			<td>".$referer_name."</td>
			<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			";

//	}
	$mString = $mString."</table>";

	return $mString;
}



function PrintLogSummaryLeft(){
	//global $db, $mdb;
	$db = new Database;
	$mdb = new Database;


	$sql = "select ncnt from ".TBL_LOGSTORY_VISITTIME." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$visit = $db->dt[ncnt];

	$sql = "select ncnt from ".TBL_LOGSTORY_VISITOR." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$visitor = $db->dt[ncnt];

	$sql2 = "select sum(case when code != '' then 1 else 0 end)  as reg_member_cnt
			from ".TBL_COMMON_USER." where substring(date,1,10) = '".date("Y-m-d")."'  ";
	$mdb->query($sql);
	$mdb->fetch();

	$sql = "select ncnt from ".TBL_LOGSTORY_PAGEVIEWTIME." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$pageview = $db->dt[ncnt];

/*
	$sql = "Select r.cid, r.cname, sum(b.visit_cnt) as visit_cnt from ".TBL_LOGSTORY_REFERER_CATEGORYINFO." r, ".TBL_LOGSTORY_BYREFERER." b where b.vdate = '".date("Ymd")."' and substring(r.cid,1,9) = substring(b.vreferer_id,1,9) and r.cid LIKE '000001%' group by r.cid, r.cname order by visit_cnt  desc limit 0,1";
	$db->query($sql);
	$db->fetch();
	$referer_name = $db->dt[cname];
	$visitreferer = $db->dt[visit_cnt];
*/

	$sql = "select ncnt from ".TBL_LOGSTORY_PAGEVIEWTIME." where vdate = '".(date("Ymd"))."'  ";
	$db->query($sql);
	$db->fetch();
	$pageview = $db->dt[ncnt];




	$mString = "<table cellpadding=1 cellspacing=0 width=100% >
			<col width=60%>
			<col width=40%>
			<tr height=25 bgcolor=#ffffff align=center height=25>
				<td align=center bgcolor='#efefef' ><a href='/admin/logstory/report/pageview1.php?SubID=SM114641Sub' class=small title='금일페이지뷰'>금일페이지뷰 </a></td>
				<td>".number_format($pageview,0)."</td>
				<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
				<td align=center bgcolor='#efefef'><a href='/admin/logstory/report/visit.php?SubID=SM11464243Sub' class=small title='금일방문횟수'>금일방문횟수 </a></td>
				<td>".number_format($visit,0)."</td>
				<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
				<td align=center bgcolor='#efefef'><a href='/admin/logstory/report/visitor.php?SubID=SM1146487Sub' class=small title='금일방문자수'>금일방문자수 </a></td>
				<td>".number_format($visitor,0)."</td>
				<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			<tr bgcolor=#ffffff  align=center height=25>
				<td align=center bgcolor='#efefef'><a href='/admin/logstory/report/visitbyreferer.php?SubID=SM11464176Sub' class=small title='최다유입사이트'>최다유입사이트 </a></td>
				<td>".$referer_name."</td>
				<td></td>
			</tr>
			<tr height=1><td colspan=6 class=dot-x></td></tr>
			";


	$mString = $mString."</table>";

	return $mString;
}
?>