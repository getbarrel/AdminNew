<?include($_SERVER["DOCUMENT_ROOT"]."/class/database.class");$db = new Database;if($gift_type=="E") {	if(!$gift_type_num) {		$eque="SELECT MAX(gift_type_num) as maxnum FROM shop_offline_cupon";		$db->query($sql);		$db->fetch();		$erow=$db->dt[maxnum];		if($erow[0]) {			$gift_type_num=$erow[0]+1;		}else{			$gift_type_num=1;		}	}else{		$gift_type_num=$gift_type_num;	}}else{	if(!$gift_type){		$gift_type = "G";	}	$gift_type_num="";}if($act == "update"){	$gift_start_date = $FromYY."-".$FromMM."-".$FromDD;	$gift_end_date = $ToYY."-".$ToMM."-".$ToDD;		$sql = "update shop_offline_cupon set 					gift_code='$gift_code',gift_amount='$gift_amount',gift_start_date='$gift_start_date',gift_end_date='$gift_end_date',								gift_change_state='$gift_change_state',	gift_type='$gift_type',mem_type='$mem_type',use_priod='$use_priod',					gift_type_num='$gift_type_num',reg_member_id='$reg_member_id',reg_ip='$reg_ip',reg_date='$reg_date',member_id='$member_id',					member_ip='$member_ip',chagne_request_date='$chagne_request_date',memo='$memo' 					where uid='$uid' ";	$db->query($sql);	echo "<script>alert('상품권 정보가 정상적으로 수정되었습니다.');parent.document.location.reload();</script>";}if($act == "insert"){//	print_r($_POST);//	exit;	$gift_start_date = $FromYY."-".$FromMM."-".$FromDD;	$gift_end_date = $ToYY."-".$ToMM."-".$ToDD;		$pattern = "1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ"; 	for($Loop=0;$Loop<$endLoop;$Loop++) {		for($i=0;$i<$length;$i++){			$key .= $pattern{rand(0,35)};		}			$sql = "Select * from shop_offline_cupon where gift_code ='".trim($basic_code.$key)."' ";		$db->query($sql);		if(!$db->total){			if(trim($key) != ""){				$sql = "insert into shop_offline_cupon 							(uid,gift_code,gift_amount,gift_start_date,gift_end_date,gift_change_state,gift_type,event_gift_num, mem_type, use_priod,reg_member_id,reg_ip,reg_date,memo) 							values							('$uid','".$basic_code.$key."','$gift_amount','$gift_start_date','$gift_end_date','0','$gift_type','$event_gift_num','$mem_type','$use_priod','".$admininfo["company_id"]."','".$_SERVER["REMOTE_ADDR"]."',NOW(),'$memo')";				//echo $i.":".$sql."<br>\n";				if($check_mode != "test"){					$db->query($sql);				}			$new_cnt++;			}		}else{			$dupe_cnt++;		}		$key = '';	}	//exit;	if($next_mode == "goon"){		if($check_mode == "test"){			echo "<script>alert('상품권 정보가 정상적으로 확인되었습니다. 등록 : $new_cnt , 중복 : $dupe_cnt ');</script>";		}else{			echo "<script>alert('상품권 정보가 정상적으로 등록되었습니다. 등록 : $new_cnt , 중복 : $dupe_cnt ');</script>";		}	}else{		if($check_mode == "test"){			echo "<script>alert('상품권 정보가 정상적으로 확인되었습니다. 등록 : $new_cnt , 중복 : $dupe_cnt ');parent.document.location.reload();</script>";		}else{			echo "<script>alert('상품권 정보가 정상적으로 등록되었습니다. 등록 : $new_cnt , 중복 : $dupe_cnt ');parent.document.location.reload();</script>";		}	}}if($act == "delete"){		$sql = "delete from shop_offline_cupon where uid='$uid' ";						$db->query($sql);	echo "<script>alert(\"상품권 정보가 정상적으로 삭제 되었습니다. \");parent.document.location.reload();</script>";}?>